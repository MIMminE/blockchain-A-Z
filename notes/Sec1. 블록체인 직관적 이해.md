## 블록체인이란?

## SHA256 - 해시 이해하기

어떤 파일이든, 어떤 데이터든 고유하게 식별할 수 있는 디지털 지문을 **Hash**라고 부른다. SHA256은 해시 알고리즘 중 하나로, 입력 데이터에 대해 256비트(32바이트)의 고정 길이 해시 값을
생성한다. 이 해시 값은 입력 데이터가 조금이라도 변경되면 완전히 다른 값으로 바뀌기 때문에 데이터의 무결성을 검증하는 데 매우 유용하다.

**SHA256**은 미국 국가안보국(NSA)에서 개발했으며, Secure Hash Algorithm 256의 약자로 불린다. SHA256은 다음과 같은 특징을 가지고 있다:

- **고정 길이 출력**: 입력 데이터의 크기와 상관없이 항상 256비트(32바이트)의 해시 값을 생성한다. (64자리 문자열, 16진수)
- **결정적**: 동일한 입력 데이터에 대해 항상 동일한 해시 값을 생성한다.
- **충돌 저항성**: 서로 다른 두 입력 데이터가 동일한 해시 값을 생성할 확률이 매우 낮다.
- **빠른 계산**: 해시 값을 빠르게 계산할 수 있다.
- **단방향성**: 해시 값을 통해 원래의 입력 데이터를 역으로 추정하는 것이 사실상 불가능하다.
- **범용성**: 텍스트 파일뿐 아니라, 이미지, 음악, 운영체제 파일까지 모든 종류의 데이터에 대해 해시 값을 생성할 수 있다.

### 강력한 해시 알고리즘의 5가지 필수 요건

누구나 해시 알고리즘을 만들 수 있지만, 블록체인처럼 중요한 기술에 쓰이려면 다음 5가지 요건을 반드시 충족해야 한다.

1) **단방향성 (One-Way)** : 해시 함수는 입력 데이터를 해시 값으로 변환하는 것은 쉽지만, 해시 값에서 원래의 입력 데이터를 역으로 추정하는 것은 사실상 불가능해야 한다.
2) **결정성 (Deterministic)** : 동일한 입력 데이터에 대해 항상 동일한 해시 값을 생성해야 한다.
3) **빠른 연산 속도 (Fast Computation)** : 데이터를 넣었을 때 해시값을 계산하는 속도가 매우 빨라야 한다.
4) **쇄도 효과 (Avalanche Effect)** : 입력 데이터가 조금이라도 변경되면 해시 값이 완전히 달라져야 한다.
5) **충돌 저항성 (Collision Resistance)** : 서로 다른 두 입력 데이터가 동일한 해시 값을 생성할 확률이 매우 낮아야 한다.

충돌 저항성에 관련하여 비둘기집 원리(Pigeonhole Principle)를 이해하는 것이 중요하다. 해시 함수는 무한한 입력 데이터를 유한한 해시 값 공간으로 매핑하기 때문에, 이론적으로는 서로 다른 두 입력
데이터가 동일한 해시 값을 생성할 수밖에 없다. 그러나 강력한 해시 알고리즘은 이러한 충돌이 발생할 확률을 극히 낮게 만들어야 한다.
저항성의 의미는 해커가 의도적으로 충돌을 찾아내는 것이 매우 어렵다는 것을 의미한다.

## 불변 원장 (Immutable Ledger)

어떤 거래에 대한 기록을 종이 등에 기록하는 것은 소실과 변조가 쉬우며, 디지털화하여 데이터베이스에 저장하는 것도 중앙화된 서버가 해킹당하거나 오류가 발생할 위험이 있다.
블록체인은 이러한 문제를 해결하기위해 **분산 원장 기술 (Distributed Ledger Technology, DLT)** 을 사용한다.

어떤 집을 판매할 때마다 그 기록이 담긴 새로운 블록이 생성되어 기존 체인 끝에 연결된다고 상상해보자.
이렇게 연결된 블록들의 연속체가 바로 **블록체인**이다. 각 블록은 이전 블록의 해시 값을 포함하고 있어, 하나의 블록이 변경되면 이후 모든 블록의 해시 값이 달라지게 된다.
따라서, 블록체인은 거래 기록의 무결성과 불변성을 보장한다.

해커가 이를 속이기 위해서는 조작한 블록부터 그 뒤에 이어진 모든 블록의 해시를 다시 계산해야 한다.
이는 막대한 시간적, 비용적 노력이 필요하기에 사실상 불가능하다고 본다.

분산 원장 기술이라고 함은 여러 대의 컴퓨터(노드)가 동일한 원장 사본을 보유하고, 네트워크를 통해 서로 동기화하는 방식을 의미한다.
이로 인해 단일 장애 지점(Single Point of Failure)이 제거되어, 일부 노드가 오프라인이 되거나 해킹당하더라도 전체 시스템의 무결성과 가용성이 유지된다.

결국 블록 체인의 불변 원장이라는 것은 기록된 변경 내역, 거래 내역, 상태 변화 등을 영구적으로 보존하며, 누구나 이를 검증할 수 있도록 하는 신뢰 있는 시스템을 의미한다.

## 분산 P2P 네트워크

만약 해커가 정부 기관에 있는 메인 서버를 뚫고 순식간에 모든 해시를 다시 계산해서 바꿔치기 하는것이 가능하다면 어떻게 될까? 또는 서버 오류로 인해 데이터가 손실될 경우에도 어떻게 될까?

중앙화된 시스템은 언제나 **단일 실패 지점(Single Point of Failure, SPOF)** 의 위험에 노출된다. 블록체인은 이를 해결하기 위해 **분산 P2P 네트워크**를 사용한다.

블록체인은 모두가 동일한 원장 사본을 나눠갖는 방식으로, 네트워크 참여자(노드)들이 서로 직접 연결되어 데이터를 주고받는다.
이러한 환경에서 한 대의 컴퓨터가 해킹당해 원장이 수정되더라도 다른 노드들이 보유한 원장 사본과 비교하여 변경 사항을 감지할 수 있다.

블록 체인 네트워크는 다수결의 원칙을 따르며 과반수가 동의하는 장부가 정식 장부로 채택되며, 이렇게 재택된 장부가 잘못된 장부를 덮어쓰기해가며 전체 네트워크의 무결성을 유지한다.

### 51 % 공격 : 불가능에 가까운 도전

분산된 블록체인 네트워크에 소속된 장부에 대한 변경을 하기 위해서는 전체의 과반수에 해당하는 노드에 있는 장부를 동시에 변경해야 한다. 이를 **51% 공격**이라고 부른다.
거대 네트워크를 가진 비트코인이나 이더리움 같은 경우에는 사실상 불가능에 가까운 도전이다. 해당 네트워크에 참여하는 노드가 많아질수록 보안은 기하급수적으로 강력해진다.

### Trustless Trust : 신뢰가 필요 없는 신뢰

네트워크에 참여한 익명의 개인들을 믿을수도, 믿을 필요도 없으며, 중앙의 기관도 필요없이 시스템의 수학적 알고리즘과 다수의 합의만으로 시스템을 유지할 수 있다.
이를 신뢰가 필요 없는 환경에서 신뢰를 구축하는 개념인 **Trustless Trust**라고 부른다.

## 채굴은 어떻게 작동하는라: 논스

해시와 분산 네트워크를 통해 어떻게 연결되고, 위변조를 막는지를 확인할 수 있었다.
이제 블록체인 네트워크에서 새로운 블록이 어떻게 생성되고 추가되는지, 즉 **채굴(Mining)** 과정에 대해 알아보자.

블록에는 크게 세 가지 정보가 들어있다.

1) 블록 번호 : 블록의 순서를 나타내는 고유한 번호
2) 데이터 : 해당 블록에 기록된 거래 내역 등
3) 이전 블록의 해시 값 : 이전 블록의 무결성을 검증

이러한 데이터들만 있으면 블록을 생성하고 해시 값을 계산할 수 있다. 하지만 블록체인 네트워크에서는 단순히 블록을 생성하는 것만으로는 충분하지 않다.
새로운 블록을 추가하기 위해서는 **논스(Nonce)**라는 특별한 값을 찾아야 한다.

논스(Nonce)란, **number used once**의 약자로, 채굴자가 유일하게 마음대로 바꿀 수 있는 값이다.
시스템은 아무 해시값이나 블록으로 인정하지 않고, 특정 조건을 만족하는 해시값만을 유효한 블록으로 인정한다. 예를 들어, 해시값이 일정 개수 이상의 0으로 시작해야 한다는 조건이 있을 수 있다.
채굴자는 블록 번호, 데이터, 이전 블록의 해시 값과 함께 논스 값을 바꿔가며 해시 값을 계산한다. 이 과정을 반복하여 조건을 만족하는 해시 값을 찾으면, 해당 블록이 네트워크에 추가된다.

해시 함수는 쇄도 효과(Avalanche Effect)를 가지기 때문에, 논스 값이 조금만 바뀌어도 해시 값은 완전히 달라진다.
따라서 채굴자는 무작위로 논스 값을 시도해보며 조건을 만족하는 해시 값을 찾는 과정을 반복해야 한다. 이 과정은 매우 많은 계산 능력을 요구하며, 이를 **작업 증명(Proof of Work)**이라고 부른다.

결과적으로 채굴자는 무식하게 Nonce를 바꿔가며 해시 값을 계산해야 하고 이 과정에서 막대한 전기와 컴퓨팅 파워를 소모하게 된다.

## 채굴 작동 방식 : 암호화 퍼즐

블록체인 시스템은 채굴자들에게 Target 이라는 기준선을 제시한다. 채굴에 성공하기 위해서는 Target 보다 작은 해시 값을 찾아야 한다.
해시는 16진수로 표현된 숫자이므로 앞의 숫자가 0에 가까울 수록 값이 작아진다는 특징을 가진다.
이러한 시각적 특징을 선행 제로(Leading Zero) 라고 부른다.

채굴자는 자신이 유일하게 변경할 수 있는 논스(Nonce) 값을 바꿔가며 해시 값을 계산하면서 Target 보다 작은 해시 값을 찾기 위해 노력해야 한다.
여기서 Target 값보다 작은 해시 값을 찾게 되면, 이때의 논스 값을 골든 논스(Golden Nonce) 라고 부르며, 해당 블록은 네트워크에 추가될 수 있다.

시스템이 제시하는 Target값이 낮을수록, 즉 더 많은 선행 제로(Leading Zero)를 요구할수록 유효한 해시 값을 찾기 어려워진다.
이는 전체 Nonce 중에서 유효한 해시 값을 생성하는 Nonce의 비율이 낮아지기 때문이다. 따라서 채굴 난이도는 Target 값에 의해 결정된다.

어떤 해시값이 나올지는 전혀 예측할 수 없기 때문에, 채굴자는 무작위로 Nonce 값을 시도해보며 해시 값을 계산해야 한다.
이를 **암호화 퍼즐(Cryptographic Puzzle)**이라고 부르며, 이 퍼즐을 푸는 과정이 바로 채굴(Mining)이다.

## 비잔틴 내결함성 (Byzantine Fault Tolerance)

모든 탈중앙화 시스템의 핵심 난제인 **비잔틴 장군 문제(Byzantine Generals' Problem)** 를 해결하는 것이 블록체인의 중요한 목표 중 하나이다.
비잔틴 장군 문제란, 여러 명의 장군들이 서로 신뢰할 수 없는 통신 채널을 통해 협력하여 공격 계획을 세워야 하는 상황을 가정한 문제이다.

세 명의 장군이 있고, 이들 중 한 명이 배신자라고 가정해보자. 장군들은 서로 떨어져 있으며, 오직 메신저를 통해서만 통신할 수 있다.
장군 A가 공격을 제안했을 때, 장군 B와 C는 A의 제안을 신뢰할 수 없다. 만약 B가 배신자라면, 그는 A의 메시지를 왜곡하여 C에게 전달할 수 있다.
이러한 상황에서 장군들은 어떻게 합의를 이끌어낼 수 있을까?

먼저, 각 장군은 자신의 결정을 메신저를 통해 다른 장군들에게 전달한다. 각 장군은 받은 메시지를 바탕으로 자신의 결정을 내린다.
이 과정에서, 장군들은 여러 번의 메시지 교환을 통해 서로의 결정을 확인하고, 다수결의 원칙에 따라 최종 결정을 내린다.

결과적으로 장군들은 배신자가 있더라도 신뢰할 수 있는 합의를 이끌어낼 수 있다. 이를 **비잔틴 내결함성(Byzantine Fault Tolerance, BFT)** 이라고 부른다.

블록 체인은 중앙 관리자가 없는 시스템이며, 네트워크에 참여하는 노드들이 서로 신뢰할 수 없는 상황에서도 합의를 이끌어내야 한다.
이 알고리즘의 한계는 네트워크에 참여하는 노드의 3분의 1 이상이 악의적인 행위를 할 경우, 합의가 깨질 수 있다는 점이다.

## 합의 프로토콜 (Consensus Protocol)

블록체인 네트워크는 전 세계에 흩어진 수 많은 노드가 동시에 운영된다. 이들의 목적은 통일된 장부를 유지하는 것이므로 강력한 규칙이 필요하다.

이러한 규칙을 합의 프고토콜(**Consensus Protocol**)라고 부른다.

- 공격자 방어 : 네트워크에 악의적인 노드가 포함되어 있을 수 있으므로, 이들이 장부를 조작하지 못하도록 방어하는 메커니즘이 필요하다.
- 경쟁 노드 조정 : 여러 노드가 동시에 블록을 제안할 수 있으므로, 이들 간의 경쟁을 조정하여 하나의 블록만이 채택되도록 해야 한다.

이번에는 공격자 방어와 작업 증명에 대한 원리를 다룬다.

### 작업 증명(Proof of Work, PoW)

누군가 타겟보다 낮은 해시값을 찾아내 네트워크에 제출하면, 다른 노드들은 해당 해시값이 타겟보다 낮은지 검증하여 유효성을 체크하게 된다.
이때, 이전 해시 블록이 일치하는지, 거래 내용등이 유효한지 등의 검증 절차도 함께 이뤄지며, 모든 검증이 완료되면 해당 블록은 체인에 추가된다.

작업을 열심히 하더라도 주변 노드의 검증을 통과하지 못하면 블록이 추가되지 않으므로, 채굴자는 정직하게 작업을 수행할 수밖에 없다.
해커 입장에서도 작업에 대한 비용만을 소모하고 검증을 통과하지 못하는 상황이 반복되므로, 결국 포기할 수밖에 없다.

이런 과정을 작업 증명이라고 하며 블록체인 네트워크의 합의 프로토콜로 널리 사용되고 있다. 이것이 쉽게 가능한 이유는 작업 난이도와 채점 난이도 차가 크기 때문이다.
작업의 경우 평균적으로 10분 이상이 소모되게 하는 반면, 검증은 몇 밀리초 내에 끝난다.

## 합의 프로코톨 : 경쟁 체인 (Competing Chains)

블록체인 네트워크는 전 세계에 퍼져 있기 때문에 정보가 전달되는 데 물리적인 시간이 걸린다. 이로 인해 지리적으로 거리가 멀다면 거의 동시에 골든 논스를 찾아내는 상황이 발생할 수 있다.
이 상황에서는 블록체인 네트워크에서는 두 형태의 블록 체인이 등장하게 된다. 이를 **경쟁 체인(Competing Chains)** 이라고 부른다.

두 개의 체인을 모두 인정한 상황에서 각 노드들은 다음 작업을 수행하게 되고, 두 체인 중 다음 블록이 먼저 생기는 체인을 진실된 체인으로 판명하고 채택하게 된다.
더 빠르게 체인이 길어진다는 것은 해당 체인을 가진 그룹이 더 강한 컴퓨팅 파워를 보유하고 있다는 것을 의미한다.

결과적으로 경쟁에서 이긴 체인이 전체 네트워크의 진실된 체인으로 인정받게 된다. 반면, 패배한 체인은 버려지게 되며, 이로 인해 해당 체인에 포함된 블록들은 무효화된다.
(해당 블록을 채굴한 채굴자는 보상을 받지 못한다.)

합의 프로토콜의 핵심은 네트워크 참여자들이 경쟁 체인 상황에서도 결국 하나의 진실된 체인에 합의할 수 있도록 하는 것이다.
비잔틴 장군 문제를 해결할 떄는 33% 미만의 악의적 노드가 있을 때 합의가 가능했지만, 경쟁 체인 상황에서는 50% 미만의 악의적 노드가 있을 때 합의가 가능하다.

그렇기 때문에 블로 체인의 합의 프로토콜이 비잔틴 내결함성보다 더 강력하다고 할 수 있다.

이러한 과정이 있기 때문에 채굴에 성공했다고 해서 곧바로 보상을 받는 것은 아니다.
일정 시간이 지나 네트워크가 해당 블록을 진실된 체인으로 인정할 때까지 기다려야 한다.